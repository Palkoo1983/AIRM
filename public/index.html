
<!doctype html>
<html lang="hu">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>AIRM — Mini (Express)</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-white text-gray-900">
  <div class="max-w-6xl mx-auto px-4 py-8">
    <h1 class="text-3xl font-semibold">AIRM — Időpontfoglalás (ÉLES API)</h1>
    <p class="text-gray-600">Állítsd be a környezeti változókat, indítsd a szervert, és foglalj.</p>

    <div class="mt-6 grid md:grid-cols-2 gap-8">
      <section>
        <h2 class="text-xl font-semibold">Szabad idősávok</h2>
        <div class="mt-3 flex gap-3 items-center">
          <input id="date" type="date" class="rounded-xl border border-gray-300 px-3 py-2" />
          <button id="load" class="rounded-xl px-4 py-2 bg-gray-900 text-white">Betöltés</button>
        </div>
        <ul id="slots" class="mt-4 grid grid-cols-3 gap-2 text-sm"></ul>
      </section>

      <section>
        <h2 class="text-xl font-semibold">Foglalás</h2>
        <div class="mt-3 grid gap-3">
          <input id="name" placeholder="Név" class="rounded-xl border border-gray-300 px-3 py-2" />
          <input id="email" type="email" placeholder="Email" class="rounded-xl border border-gray-300 px-3 py-2" />
          <select id="time" class="rounded-xl border border-gray-300 px-3 py-2">
            <option value="">Válassz idősávot</option>
          </select>
          <select id="mode" class="rounded-xl border border-gray-300 px-3 py-2">
            <option value="online">Online (Google Meet)</option>
            <option value="inperson">Személyes</option>
          </select>
          <button id="book" class="rounded-xl px-4 py-2 bg-emerald-600 text-white">Időpont foglalása</button>
          <div id="result" class="text-sm text-gray-600"></div>
        </div>
      </section>
    </div>
  </div>

  <script>
    const el = id => document.getElementById(id);
    el('load').onclick = async () => {
      const date = el('date').value;
      if(!date) return alert('Válassz dátumot!');
      const r = await fetch(`/api/calendar/slots?date=${date}`);
      const data = await r.json();
      const ul = el('slots'); ul.innerHTML = '';
      const sel = el('time'); sel.innerHTML = '<option value="">Válassz idősávot</option>';
      (data.slots||[]).forEach(t => {
        const li = document.createElement('li');
        li.innerHTML = `<button class="w-full rounded-xl border border-gray-300 px-2 py-1">${t}</button>`;
        li.querySelector('button').onclick = ()=>{ sel.value = t; };
        ul.appendChild(li);
        const opt = document.createElement('option'); opt.value = t; opt.textContent = t; sel.appendChild(opt);
      });
    };

    el('book').onclick = async () => {
      const payload = { name: el('name').value, email: el('email').value, date: el('date').value, time: el('time').value, mode: el('mode').value };
      if(!payload.name||!payload.email||!payload.date||!payload.time) return alert('Tölts ki minden mezőt!');
      const r = await fetch('/api/calendar/book', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(payload) });
      const data = await r.json();
      el('result').textContent = data.ok ? `Siker! Esemény: ${data.htmlLink||data.eventId}` : `Hiba: ${data.error}`;
    };
  </script>
</body>
</html>
